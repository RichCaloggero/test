<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Linked List Test</title>
</head>
<body>
<h1>Linked List Test</h1>

<script>
const iterations = 100000;
const observer = new PerformanceObserver(performanceObserver);
observer.observe({ entryTypes: ["measure", "mark"] });

const cons = (first, rest) => ({first, rest});

class Cons_array {
#data = null;

constructor (first, rest) {
this.#data = [first, rest];
} // constructor

first (x) {return x? (this.#data[0] = x) : this.#data[0];}
rest (x) {return x? (this.#data[1] = x) : this.#data[1];}
} // class Cons_array

class Cons_object {
#first = null;
#rest = null;

constructor (first, rest) {
this.#first = first;
this.#rest = rest;
} // constructor

first (x) {return x? (this.#first = x) : this.#first;}
rest (x) {return x? (this.#rest = x) : this.#rest;}
} // class Cons_object

function list1_array (x) {return new Cons_array(x,null);}
function list1_object (x) {return new Cons_object(x,null);}

function display (l, count = -1) {
if (l === null) return "()";
let s = "(" + l.first();
l = l.rest();
while (l && count-- !== 0) {
s += " " + l.first();
l = l.rest();
} // while

s += ")";
return s;
} // display

function display1 (l, count = -1) {
if (l === null) return "()";
let s = "(" + l.first;
l = l.rest;
while (l && count-- !== 0) {
s += " " + l.first;
l = l.rest;
} // while

s += ")";
return s;
} // display1

function last (l) {
while (l.rest()) l = l.rest();
return l;
} // last

function last1 (l) {
while (l.rest) l = l.rest;
return l;
} // last1


/*console.log("test: ", display(
new Cons_array(1, new Cons_array(2, new Cons_array(3, new Cons_array(4, null))))
));
*/

/*// cons_array test
performance.mark("list_arrayStart");
let l = list1_array (0);
for (i=1; i <= iterations; i++) {
last(l).rest(new Cons_array(i, null));
} // for
performance.mark("list_arrayDone");
performance.measure("list_arrayDuration", "list_arrayStart", "list_arrayDone");
*/

// cons_object test
performance.mark("list_objectStart");
l = list1_object(0);
for (i=1; i <= iterations; i++) {
last(l).rest(new Cons_object(i, null));
} // for
console.log("list_object: ", display(l, 7));
performance.mark("list_objectDone");
performance.measure("list_objectDuration", "list_objectStart", "list_objectDone");

// cons_function test
performance.mark("list_functionStart");
l = cons(0, null);
for (i=1; i <= iterations; i++) {
last1(l).rest = cons(i, null);
} // for
console.log("list_function: ", display1(l, 7));
performance.mark("list_functionDone");
performance.measure("list_functionDuration", "list_functionStart", "list_functionDone");


function performanceObserver(list, observer) {
list.getEntries().forEach((entry) => {
if (entry.entryType === "mark") {
console.log(`${entry.name} = ${entry.startTime}`);
} // if

if (entry.entryType === "measure") {
console.log(`${entry.name}: duration = ${entry.duration}`);
} // if
}); // forEach
} // performanceObserver

</script>

</body>
</html>

<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Test</title>
</head>
<body>
<h1>Testing S</h1>

<fieldset ><legend><h2>Polar</h2></legend>
<label>radius: <input type="number" id="r"></label>
<label>angle: <input type="number" id="a"></label>
</fieldset>

<fieldset ><legend><h2>Cartesian</h2></legend>
<label>x: <input type="number" id="x"></label>
<label>y: <input type="number" id="y"></label>
</fieldset>

<div  id="message" role="log"></div>
<button id="clear">clear</button>



<script src="S.js"></script>
<script>
S.root(() => {
const _r = ui("r");
const _a = ui("a");
const _x = ui("x");
const _y = ui("y");
const r = S.value(0);
const a = S.value(0);
const x = S.value(0);
const y = S.value(0);

_r.addEventListener("change", e => get(Number(e.target.value), r, "r"));
_a.addEventListener("change", e => get(Number(e.target.value), a, "a"));
_x.addEventListener("change", e => get(Number(e.target.value), x, "x"));
_y.addEventListener("change", e => get(Number(e.target.value), y, "y"));
ui("clear").addEventListener("click", () => ui("message").innerHTML = "");

S(() => {
message("converting to polar");
const [_r, _a] = toPolar(x(), y());
r(_r);
a(_a);
});

S(() => {
message("converting to cartesian");
const [_x, _y] = toCartesian(r(), a());
x(_x);
y(_y);
});

//S(() => {
//probe(r, "r");
//probe(a, "a");
probe(x, "x");
probe(y, "y");
//});

S(() => write(r(), _r, "r"));
S(() => write(a(), _a, "a"));
S(() => write(x(), _x, "x"));
S(() => write(y(), _y, "y"));

});

function toPolar (_x, _y) {
return [
Math.sqrt(_x*_x + _y*_y),
Math.atan2(_y, _x)
];
} // toPolar

function toCartesian (_r, _a) {
return [
_r * Math.cos(_a),
_r * Math.sin(_a)
];
} // toCartesian

function get (value, signal, name) {
message(`get: ${name} = ${typeof(value)} ${value}`);
signal(value);
} // get

function write (value, element, name) {
element.value = value;
message(`write: ${typeof(value)} ${value} to ${name}`);
} // write

function probe (signal, name) {
S(() => {
message(`probe: ${name} = ${signal()}`);
return signal;
});
} // probe

function message(text) {
ui("message").insertAdjacentHTML("beforeEnd", `<p>${text}</p>`);
} // message

function ui(element) {
return (
element instanceof HTMLElement? element
: document.getElementById(element)
); // return
} // ui
 
</script>

</body>
</html>

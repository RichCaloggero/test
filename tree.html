<!DOCTYPE HTML>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Test</title>
</head>
<body>
<h1>Tree</h1>

<div role="tree" class="choose"></div>

<script>
const $tree = document.querySelector("[role='tree']");
const choices = [
"chemistry", "biology", "physics", "mathematics", "computer science",
{label: "engineering", choices: [
"mechanical engineering", "civil engineering", "electrical engineering"]
}];

$tree.insertAdjacentHTML("beforeEnd", buildTree(choices));
setFocus(getFocus($tree), $tree);

$tree.addEventListener("keydown", e => {
let $node = getFocus($tree);
if (e.key === "ArrowDown") setFocus(nextSibling($node), $tree);
else if (e.key === "ArrowUp") setFocus(previousSibling($node), $tree);
else if (e.key === "ArrowRight" && $node.hasAttribute("aria-expanded")) setFocus(downLevel($node), $tree);
else if (e.key === "ArrowLeft" && $node.parentElement.hasAttribute("aria-expanded")) setFocus(upLevel($node), $tree);
});

function buildTree (choices, label) {
let html = (label)? `<div role="treeitem" aria-expanded="false" aria-label="${label}">
<span class="icon"></span>
${label}
` : "";

for (choice of choices) {
if (choice instanceof Object) {
html += buildTree(choice.choices, choice.label);
} else {
html += `<div role="treeitem" tabindex="-1">
<span class="icon"></span>
${choice}
</div>
`;
} // if
} // for

if (label) html += "\n</div>\n";
return html;
} // buildTree

function nextSibling ($node) {
$newNode = $node.nextElementSibling;
return $newNode && $newNode.matches("[role='treeitem']")? $newNode : $node;
} // nextSibling

function previousSibling ($node) {
$newNode = $node.previousElementSibling;
return $newNode && $newNode.matches("[role='treeitem']")? $newNode : $node;
} // previousSibling

function downLevel ($node) {
const $newNode = $node.querySelector("[role='treeitem']");
if ($newNode) $node.setAttribute("aria-expanded", "true");
return $newNode || $node;
} // downLevel

function upLevel ($node) {
const $newNode = $node.parentElement.hasAttribute("aria-expanded")? $node.parentElement : $node;
if ($newNode !== $node) $newNode.setAttribute("aria-expanded", "false");
return $newNode;
} // upLevel

function getFocus ($tree) {
return $tree.querySelector("[tabindex='0']") || $tree.querySelector("[tabindex='-1']");
} // getFocus

function setFocus ($node, $tree) {
clearFocus($tree);
$node.tabIndex = 0;
$node.focus();
return $node;
} // setFocus

function clearFocus ($tree) {
$tree.querySelectorAll("[tabindex]").forEach(x => x.tabIndex = -1);
} // clearFocus

function not (x) {return !x;}
</script>

</body>
</html>

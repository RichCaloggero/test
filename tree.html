<!DOCTYPE html>
<html lang="">
<head>
<meta charset="utf-8">
<title>tree menu Test</title>

<style>
nav ul {list-style-type: none;}
nav li > ul {display: none;}
nav li > ul.open {display: block;}
</style>

</head>
<body>
<nav aria-label="site">
<div><a href="/">Home</a></div>

<ul>
<li>
<a href="#">Admissions &amp; Aid</a>

<ul>
<li><a href="https://mitfactsprod.wpengine.com/undergraduate-admissions/">Undergraduate Admissions<span></span></a>

<ul>
<li><a href="https://mitfactsprod.wpengine.com/undergraduate-admissions/undergraduate-tuition/">Undergraduate Tuition &amp; Aid<span></span></a></li>

<li><a href="https://mitfactsprod.wpengine.com/undergraduate-admissions/undergraduate-financial-aid/">Undergraduate Financial Aid<span></span></a></li>
</ul>
</li>

<li><a href="https://mitfactsprod.wpengine.com/graduate-student-admission/">Graduate Admissions<span></span></a>

<ul>
<li><a href="https://mitfactsprod.wpengine.com/graduate-student-admission/graduate-tuition/">Graduate Tuition<span></span></a></li>
<li><a href="https://mitfactsprod.wpengine.com/graduate-student-admission/graduate-financial-aid/">Graduate Financial Aid<span></span></a></li>
</ul>
</li>
</ul>
</li>

<li><a href="#">People</a>
<ul>

<li><a href="https://mitfactsprod.wpengine.com/enrollment-statistics/">Enrollment Statistics<span></span></a></li>

<li><a href="https://mitfactsprod.wpengine.com/undergraduate-students/">Undergraduate Students<span></span></a></li>

<li><a href="https://mitfactsprod.wpengine.com/graduate-students/">Graduate Students<span></span></a></li>

<li><a href="https://mitfactsprod.wpengine.com/employees/">Employees<span></span></a>
<ul>

<li><a href="https://mitfactsprod.wpengine.com/employees/faculty/">Faculty &amp; Instructional Staff<span></span></a></li>

<li><a href="https://mitfactsprod.wpengine.com/employees/staff/">Staff<span></span></a></li>

<li><a href="https://mitfactsprod.wpengine.com/employees/postdocs-by-school/">Postdoctoral Scholars<span></span></a></li>
</ul>
</li>

<li><a href="https://mitfactsprod.wpengine.com/alumni/">Alumni<span></span></a>
<ul>

<li><a href="https://mitfactsprod.wpengine.com/alumni/mit-alumni-association/">MIT Alumni Association<span></span></a></li>
</ul>
</li>

<li><a href="https://mitfactsprod.wpengine.com/awards-honors/">Awards &amp; Honors<span></span></a></li>
</ul>
</li>

<li><a href="#">Education</a>
<ul>

<li><a href="https://mitfactsprod.wpengine.com/schools-college/">Schools &amp; College<span></span></a></li>

<li><a href="https://mitfactsprod.wpengine.com/degrees-majors/">Degrees &amp; Majors<span></span></a></li>

<li><a href="https://mitfactsprod.wpengine.com/academic-campus-resources/">Academic &amp; Campus Resources<span></span></a>
<ul>

<li><a href="https://mitfactsprod.wpengine.com/academic-campus-resources/mit-libraries/">MIT Libraries<span></span></a></li>

<li><a href="https://mitfactsprod.wpengine.com/academic-campus-resources/computing-on-campus/">Computing on Campus<span></span></a></li>

<li><a href="https://mitfactsprod.wpengine.com/academic-campus-resources/makerspaces/">Makerspaces<span></span></a></li>

<li><a href="https://mitfactsprod.wpengine.com/academic-campus-resources/open-learning/">Open Learning<span></span></a></li>
</ul>
</li>
</ul>
</li>

<li><a href="#">Life at MIT</a>
<ul>

<li><a href="https://mitfactsprod.wpengine.com/mit-campus/">MIT Campus<span></span></a>
<ul>

<li><a href="https://mitfactsprod.wpengine.com/mit-campus/sustainability/">Sustainability<span></span></a></li>
</ul>
</li>

<li><a href="https://mitfactsprod.wpengine.com/arts-at-mit/">Arts at MIT<span></span></a></li>

<li><a href="https://mitfactsprod.wpengine.com/athletics-recreation/">Athletics &amp; Recreation<span></span></a></li>

<li><a href="https://mitfactsprod.wpengine.com/fun-culture/">Fun &amp; Culture<span></span></a></li>
</ul>
</li>

<li><a href="#">Research &amp; Innovation</a>
<ul>

<li><a href="https://mitfactsprod.wpengine.com/research-highlights/">Research at MIT<span></span></a></li>

<li><a href="https://mitfactsprod.wpengine.com/research-highlights/research-centers-labs-and-programs/">Research Centers, Labs &amp; Programs<span></span></a>
<ul>

<li><a href="https://mitfactsprod.wpengine.com/research-highlights/research-centers-labs-and-programs/centers-labs-institutes/">Centers, Labs &amp; Institutes<span></span></a></li>

<li><a href="https://mitfactsprod.wpengine.com/research-highlights/research-centers-labs-and-programs/institute-initiatives/">Institute Initiatives<span></span></a></li>

<li><a href="https://mitfactsprod.wpengine.com/research-highlights/research-centers-labs-and-programs/prominent-programs/">Prominent Programs<span></span></a></li>
</ul>
</li>

<li><a href="https://mitfactsprod.wpengine.com/key-local-collaborators/">Key Local Collaborators<span></span></a></li>

<li><a href="https://mitfactsprod.wpengine.com/lincoln-laboratory/">Lincoln Laboratory<span></span></a></li>

<li><a href="https://mitfactsprod.wpengine.com/mit-industry/">MIT &amp; Industry<span></span></a></li>

<li><a href="https://mitfactsprod.wpengine.com/entrepreneurship-innovation/">Entrepreneurship &amp; Innovation<span></span></a></li>
</ul>
</li>

<li><a href="#">Organization</a>
<ul>

<li><a href="https://mitfactsprod.wpengine.com/mission/">Mission<span></span></a></li>

<li><a href="https://mitfactsprod.wpengine.com/origins/">Origins<span></span></a></li>

<li><a href="https://mitfactsprod.wpengine.com/leadership/">Leadership<span></span></a></li>

<li><a href="https://mitfactsprod.wpengine.com/mit-and-community/">MIT &amp; the Community<span></span></a></li>

<li><a href="https://mitfactsprod.wpengine.com/resource-development/">Resource Development<span></span></a></li>

<li><a href="https://mitfactsprod.wpengine.com/operating-financials/">Operating Financials<span></span></a></li>

<li><a href="https://mitfactsprod.wpengine.com/accreditation/">Accreditation<span></span></a></li>
</ul>
</li>
</ul></nav>

<main>
<p>Not much to see here.</p>
</main>
<footer>
<a href="#">refresh</a>
</footer>


<script>

initTree($("nav > ul"), "menu");

function initTree (root, menu = false) {
const roles = setRoles(menu);
root.setAttribute("role", roles.top);

$$("a, button, [tabindex]", root).forEach(x => x.setAttribute("tabindex", "-1"));

$$("ul, ol", root).forEach(subtree => subtree.setAttribute("role", roles.sub));
 
$$("li", root).forEach(branch => {
branch.setAttribute("role", roles.branch);
if ($("ul", branch)) {
branch.setAttribute("aria-expanded", "false");
if (menu) branch.setAttribute("aria-haspopup", "true");
} // if
}); // forEach branch

return initTreeNavigation(root);

function initTreeNavigation (root) {
let currentNode = null;
currentNode = focusNode(root.firstElementChild);

root.addEventListener("keydown", e => {
const key = e.key;

switch (key) {
case "ArrowDown": return focusNode(next(currentNode));
case "ArrowUp": return focusNode(previous(currentNode));

case "ArrowRight": return focusNode(down(currentNode));
case "ArrowLeft": return focusNode(up(currentNode));

case "Enter": return activateNode(currentNode);

default: return true;
} // switch
}); // keydown

function next (node) {return node.nextElementSibling;}
function previous (node) {return node.previousElementSibling;}

function down (node) {
if (isLeafNode(node)) return null;
$(`[role=${roles.sub}]`, node).classList.add("open");
return $(`[role=${roles.sub}] > [role=${roles.branch}]`, node);
} // down

function up (node) {
node.parentElement.classList.remove("open");
const newNode = node.parentElement.closest(`[role=${roles.branch}]`);
newNode.setAttribute("aria-expanded", "false");
return newNode;
} // up

function focusNode (node) {
if (node) {
$$(`[role=${roles.branch}]`, root).forEach(branch => branch.setAttribute("tabindex", "-1"));
node.setAttribute("tabindex", "0");
currentNode = node;
node.focus();
} // if

return currentNode;
} // focusNode

function activateNode (node) {
const link = $("[href]", node);
if (link) location = link.getAttribute("href");
} // activateNode

function isLeafNode (node) {return node && !node.hasAttribute("aria-expanded");}
} // initTreeNavigation

function setRoles (menu) {
return menu?
{top: "menubar", branch: "menuitem", sub: "menu"}
: {top: "tree", branch: "treeitem", sub: "group"};
} // setRoles
} // initTree

function $ (selector, context = document) {
return context.querySelector(selector);
} // $

function $$ (selector, context = document) {
return context.querySelectorAll(selector);
} // $$

</script>
</body>
</html>

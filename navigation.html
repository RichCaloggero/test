<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Navigation Test</title>
<style>
nav ul {list-style-type: none;}
</style>
</head>
<body>
<div id="message" aria-live="polite"></div>

<nav>
<ul id="top"><li>1.1
</li><li>
1.2
<ul hidden><li>
2.1
</li><li>
2.2
</li><li>
2.3
</li></ul>
</li><li>
1.3
<ul hidden><li>
3.1
</li><li>
3.2
</li><li>
3.3
</li></ul>
</li></ul>
</nav>
<p><a href="#">--end--</a></p>


<script>
const nav = document.querySelector("nav");
let lastFocus = null;
makeLinks (nav)
nav.addEventListener("focusin", focusIn);
nav.addEventListener("focusout", focusOut);

function focusIn (e) {
const next = e.target.nextElementSibling;
//message(`${e.target.nodeName}, ${next.nodeName}`);
if (next && next.matches("ul")) next.removeAttribute("hidden");
} // focusIn

function focusOut (e) {
lastFocus = e.target.parentElement;
} // focusOut

function message (text) {
document.querySelector("#message").textContent = `${text}\n`;
} // message

function makeLinks (nav) {
Array.from(nav.querySelectorAll("li")).forEach (li => {
const text = li.replaceChild(
makeLink(li.firstChild.textContent),
li.firstChild
);
});
return nav;


function makeLink (text) {
const link = document.createElement("a");
link.textContent = text;
link.href = "#";
return link;
} // makeLink
} // makeLinks


</script>


</body>
</html>
